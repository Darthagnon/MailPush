# MailPushRu
Это плагин «KUAL» для Kindle, который реализует функцию загрузки книг по почте, аналогичную «Send-to-Kindle» от Amazon, но не зависит от электронной почты Kindle, зарегистрированной в Amazon, и может использовать любую электронную почту. Перед использованием этого плагина убедитесь, что вы установили джейлбрейк на ваше устройство а также KUAL и Python3. Поскольку основная часть этого плагина основана на стандартной библиотеке `Python3`, программы в папке `src` на самом деле являются кросс-платформенными и могут работать на любой операционной системе и платформе, где установлен `Python3`.
## Функции
* Поддержка загрузки файлов через вложения электронной почты
* Поддержка загрузки файлов через ссылку на скачивание файла в электронном письме. Иногда это более удобно и позволяет обойти ограничение размера файла почтового ящика.
* Поддержка загрузки в виде сжатого пакета, плагин автоматически распакует, поддерживает zip, tar, gztar, bztar и другие форматы.
* Поддержка указания пути или имени файла для сохранения на устройстве.
* В отличие от официального сервиса Amazon, у нас нет понятия «одобренных отправителей» или других белых списков, любой почтовый ящик может отправлять вам файлы
* В отличие от официального сервиса Amazon, мы поддерживаем отправку файлов любого формата в любой каталог (не ограничиваясь книгами), плагин не обнаружит его и не будет выполнять никаких преобразований формата, кроме распаковки архива.

Тут могут быть некоторые проблемы с безопасностью, поэтому вам лучше использовать почтовый ящик с относительно сложным именем и не рассказывать о нём никому. В качестве альтернативы можно указать более строгий путь для `root` в файле `config.json`, и файлы, отправленные по почте, не смогут быть загружены за пределы `root` каталога и его подкаталогов. `root` по умолчанию является корневым каталогом USB-диска Kindle (/mnt/us/), внимательно измените его.
## Установка
1. Перейдите на страницу релизов (https://github.com/DarkAssassinUA/MailPushRUS/releases) скачайте и распакуйте в любое удобное для вас место.
2. В распакованной папке`MailPush/src` найдите файл`config.json`и откройте его в любом текстовом редакторе
   * В строке `user` укажите почтовый ящик откуда будет осуществляться загрузка.Внимание!Не используйте свой основной ящик, заведите отдельный!
   * В строке `password` укажите пароль от ящика.Будьте внимательны - пароль хранится в открытом виде!
   * В строках `host` и `port` укажите IMAP адрес и порт вашего почтового сервиса.Таблица с данными популярных поставщиков находится внизу.
   * Остальные параметры изменяются по желанию.
   * `downloaddir` это путь загрузки по умолчанию；`maxage` максимальный возраст письма в днях；`maxnum`максимальное количество загружаемых писем
4. Папку `MailPush` переместите в папку `extensions` вашего устройства.
5. В соответствии с настройками вашего почтового сервиса включите поддержку службы IMAP на странице настроек.Методы отличаются у каждого почтового сервиса.Например, Outlook по умолчанию включает службу IMAP, поэтому никаких действий не требуется;
6. Также для некоторых почтовых сервисов(например Yahoo,Google,Mail.ru) требуется создать пароль приложения т.к с обычным паролем может не пустить и,как следствие, будет ошибка и загрузка не удастся.
## Как использовать
1. Отправьте на почтовый ящик указанный в `user` письмо с файлом.Тему можно не указывать.
   * Вы можете вложить любой тип файла
   * Строка в теме или основной части может быть ссылкой на скачивание файла. Несколько ссылок разделяются пробелами или "|" или заключаются в рамки "<" и ">" соответственно, но запятые или точки с запятой не поддерживаются.
   * Строка в теме или основной части может начинаться с ключевого слова`saveto` Нчало ключевого слова используется для указания пути или имени файла, загружаемого в Kindle. Имена нескольких файлов разделяются символом "|" или заключаются в рамки "<" и ">" соответственно и не могут быть разделены пробелами.Путь по умолчанию настраивается с помощью параметра `downloaddir`, а по умолчанию используется значение `/mnt/us/documents/downloads` 
   * Формат,такой как：
      > * `saveto abc.pdf` Означает что файл сохраняется в `mnt/us/documents/abc.pdf `
      > * `saveto books/` Означает что файл сохраняется в `/mnt/us/documents/downloads/books/` но имя файла остается прежним
      > * `saveto /mnt/us/123.epub` Означает что файл сохраняется в `/mnt/us/123.epub`
      > * `saveto abc.pdf | def.pdf` Означает, что первые два файла сохраняются в `/mnt/us/documents/downloads/abc.pdf` и `/mnt/us/documents/downloads/def.pdf`
2. Откройте `KUAL`，и выберите `MailPush`.Нажмите на `Непрочитанные письма за 2 дня`что бы загрузить непрочитанные письма за последние два дня или нажмите на `Все письма за 7 дней`что бы загрузить файлы из всех сообщений за последние 7 дней.Лог файл будет сохранен в `extensions/MailPush/`как `log.txt`и `result.txt`для просмотра。Если установлен плагин `Leafpad`，так же можно открыть через меню.
3. После выбора режима загрузки плагин зависает на`Fetching...` или `Time out` вероятно что возникла проблема с сетью.Попробуйте позже или используйте другого почтового провайдера.
4. Если операция прошла успешно, но файл не был загружен, пожалуйста, сначала проверьте `result.txt`есть ли в нем загруженный файл и путь к нему, если загрузки действительно нет, вы можете нажать`Все письма за последние 7 дней`.
## Таблица IMAP хостов популярных почтовых сервисов:
|Почтовый сервис|host|port|
|----|----|----|
|gmail|imap.gmail.com|993|
|yahoo|imap.mail.yahoo.com|993|
|outlook|imap-mail.outlook.com|993|
|hotmail|outlook.office365.com|993|
|mailru|imap.mail.ru|993|
|rambler|imap.rambler.ru|993|
|yandex|imap.yandex.ru|993|

